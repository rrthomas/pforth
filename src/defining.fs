\ Defining
\
\ (c) Reuben Thomas 1995-2019
\
\ The package is distributed under the GNU GPL version 3, or, at your
\ option, any later version.
\
\ THIS PROGRAM IS PROVIDED AS IS, WITH NO WARRANTY. USE IS AT THE USERâ€™S
\ RISK.

: CREATE   BL WORD HEADER  CREATE,  ALIGN  LAST .BODY-LABEL-DEF ;
INCLUDE" does.fs"

: VARIABLE   CREATE  1 ALLOT-CELLS ;
: CONSTANT   BL WORD HEADER  LINK,  POSTPONE LITERAL  UNLINK, ;
: VALUE   CREATE  ,  DOES>  @ ;
: .BODY-LITERAL   ." pushreli " .NAME ." _body" CR ;
: BODY-LITERAL
   DUP FIND  0= IF  UNDEFINED  THEN
   >BODY  PUSHREL,
   ['] .BODY-LITERAL  TO-ASMOUT ;
: TO   ' >BODY ! ;
   :NONAME   BL WORD  BODY-LITERAL  POSTPONE ! ;IMMEDIATE

: .DEFER-ADDRESS   ." .word " .NAME ." _defer - ." CR ;
: DEFER   CREATE  HERE  ['] ABORT >REL RAW,  LAST >NAME ['] .DEFER-ADDRESS TO-ASMOUT  DOES>  REL@ EXECUTE ;
: ACTION-OF   ' DEFER@ ;
   :NONAME   POSTPONE [']  POSTPONE DEFER@ ;IMMEDIATE
: .DEFER-LABEL   ." .set " .NAME ." _defer, "
   DUP >INFO CELL 1- + C@ IF  >NAME .NAME  ELSE NONAME .LABEL  THEN  CR ;
: .DEFER-ABORT   ." .set " .NAME ." _defer, ABORT" CR ;
: IS   '  2DUP >NAME ['] .DEFER-LABEL TO-ASMOUT  DEFER! ;
   :NONAME   POSTPONE [']  POSTPONE DEFER! ;IMMEDIATE
